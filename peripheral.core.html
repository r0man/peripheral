<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>peripheral.core documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="highlight/solarized-light.css" /><script type="text/javascript" src="highlight/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a> with <a href="https://github.com/xsc/codox-theme-rdash">RDash UI</a> theme</h2><h1><a href="index.html"><span class="project-title"><span class="project-name">peripheral</span> <span class="project-version">0.5.3</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1 current"><a href="peripheral.core.html"><div class="inner"><span>peripheral.core</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="peripheral.core.html#var-attach"><div class="inner"><span>attach</span></div></a></li><li class="depth-1"><a href="peripheral.core.html#var-concurrently"><div class="inner"><span>concurrently</span></div></a></li><li class="depth-1"><a href="peripheral.core.html#var-connect"><div class="inner"><span>connect</span></div></a></li><li class="depth-1"><a href="peripheral.core.html#var-defcomponent"><div class="inner"><span>defcomponent</span></div></a></li><li class="depth-1"><a href="peripheral.core.html#var-defsystem"><div class="inner"><span>defsystem</span></div></a></li><li class="depth-1"><a href="peripheral.core.html#var-defsystem.2B"><div class="inner"><span>defsystem+</span></div></a></li><li class="depth-1"><a href="peripheral.core.html#var-detach"><div class="inner"><span>detach</span></div></a></li><li class="depth-1"><a href="peripheral.core.html#var-reify-component"><div class="inner"><span>reify-component</span></div></a></li><li class="depth-1"><a href="peripheral.core.html#var-restart"><div class="inner"><span>restart</span></div></a></li><li class="depth-1"><a href="peripheral.core.html#var-running.3F"><div class="inner"><span>running?</span></div></a></li><li class="depth-1"><a href="peripheral.core.html#var-start"><div class="inner"><span>start</span></div></a></li><li class="depth-1"><a href="peripheral.core.html#var-stop"><div class="inner"><span>stop</span></div></a></li><li class="depth-1"><a href="peripheral.core.html#var-subsystem"><div class="inner"><span>subsystem</span></div></a></li><li class="depth-1"><a href="peripheral.core.html#var-with-start"><div class="inner"><span>with-start</span></div></a></li><li class="depth-1"><a href="peripheral.core.html#var-with-start*"><div class="inner"><span>with-start*</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">peripheral.core</h1><div class="doc"><div class="markdown"></div></div><div class="public anchor" id="var-attach"><h3>attach</h3><div class="usage"><code>(attach component k attach-component)</code><code>(attach component k attach-component dependencies)</code></div><div class="doc"><div class="markdown"><p>Attach the given component to this one (associng it using <code>k</code> and having it depend on <code>dependencies</code>).</p></div></div><div class="src-link"><a href="https://github.com/xsc/peripheral/blob/master/src/peripheral/component/attach.clj#L49">view source</a></div></div><div class="public anchor" id="var-concurrently"><h3>concurrently</h3><div class="usage"><code>(concurrently component-seq)</code></div><div class="doc"><div class="markdown"><p>Tag the seq of components as elligible to be concurrently started. The return value is the same sequence of components, but #’start-all will start them concurrently.</p></div></div><div class="src-link"><a href="https://github.com/xsc/peripheral/blob/master/src/peripheral/component/lifecycle.clj#L69">view source</a></div></div><div class="public anchor" id="var-connect"><h3>connect</h3><h4 class="deprecated">deprecated in 0.5.0</h4><div class="usage"><code>(connect m src-id dst-id)</code><code>(connect m src-id src-key dst-id)</code></div><div class="doc"><div class="markdown"><p>Let the component identified by <code>src-id</code> be using the component identified by <code>dst-id</code> as a dependency to be assoc’d in at the key <code>src-key</code>.</p></div></div><div class="src-link"><a href="https://github.com/xsc/peripheral/blob/master/src/peripheral/system.clj#L14">view source</a></div></div><div class="public anchor" id="var-defcomponent"><h3>defcomponent</h3><h4 class="type">macro</h4><div class="usage"><code>(defcomponent id dependencies &amp; component-logic)</code></div><div class="doc"><div class="markdown"><p>Create new component type from a vector of <code>dependencies</code> (the components/fields that should be filled before the component is started, as well as a series of keyword/start/stop forms.</p>
<p>Each keyword has to be followed by a form that will be executed at startup and optionally a (non-keyword) function to be run at shutdown.</p>
<pre><code>(defcomponent LoopRunner [f interval]
  :data   (fetch-some-data!)
  :thread (doto (Thread. #(while (not (.isInterrupted ...)) ...))
            (.start))
          #(.interrupt ^Thread %))
</code></pre>
<p>The results of the form/function will be assoc’d into the component. Please use the <code>map-&gt;...</code> function to create an instance of the record. Using fields with the namespace <code>peripheral</code> you can manipulate the component record directly:</p>
<pre><code>(defcomponent TestComponent [...]
  :peripheral/start   #(...)      ;; called before fields are initialized
  :peripheral/started #(...)      ;; called after fields are initialized
  :peripheral/stop    #(...)      ;; called before fields are cleaned up
  :peripheral/stopped #(...))     ;; called after fields are cleaned up
</code></pre>
<p>Note that these take a function, not a form, and only allow for one value!</p>
<p>If you don’t need to alter the component record, the ‘on’ prefix can be used to directly execute forms:</p>
<pre><code>(defcomponent TestComponent [...]
  :on/start (println "starting"))
</code></pre>
<p>Finally, if you need access to the whole component, you can bind it to a symbol using ‘:this/as’:</p>
<pre><code>(defcomponent TestComponent [x]
  :this/as *this*
  :y (+ (:x *this*) 10)
  :z (- (:y *this*) 5))
</code></pre></div></div><div class="src-link"><a href="https://github.com/xsc/peripheral/blob/master/src/peripheral/component.clj#L92">view source</a></div></div><div class="public anchor" id="var-defsystem"><h3>defsystem</h3><h4 class="type">macro</h4><h4 class="deprecated">deprecated in 0.5.0</h4><div class="usage"><code>(defsystem id components &amp; logic)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/xsc/peripheral/blob/master/src/peripheral/system.clj#L145">view source</a></div></div><div class="public anchor" id="var-defsystem.2B"><h3>defsystem+</h3><h4 class="type">macro</h4><h4 class="added">added in 0.5.0</h4><div class="usage"><code>(defsystem+ id &amp; components)</code><code>(defsystem+ id [dependency ...] &amp; components)</code></div><div class="doc"><div class="markdown"><p>Create a new system of components. Example:</p>
<pre><code>(defsystem+ MySystem [^:global configuration, api-options]
  :engine    []
  :monitor   [:scheduler :api]
  :api       [:engine {:options :api-options}]
  :scheduler [:engine])
</code></pre>
<p>On startup, the following injections will happen:</p>
<ul>
  <li><code>:configuration</code> into <code>:engine</code>, <code>:api</code> and <code>:scheduler</code> (since it is  marked as <code>:global</code>),</li>
  <li><code>:engine</code> into <code>:api</code> and <code>:scheduler</code>,</li>
  <li><code>:api-options</code> - aliased as <code>:options</code> - into <code>:api</code>,</li>
  <li><code>:scheduler</code> and <code>:api</code> into <code>:monitor</code>.</li>
</ul>
<p>It is possible to give default values for each component using the <code>:default</code> metadata:</p>
<pre><code>(defsystem+ MySystem [...]
  :engine ^{:default (default-engine)} []
  ...)
</code></pre>
<p>Unless the key <code>:engine</code> is present and non-nil on system startup, it’ll be filled with the result of <code>(default-engine)</code>.</p></div></div><div class="src-link"><a href="https://github.com/xsc/peripheral/blob/master/src/peripheral/system_plus.clj#L88">view source</a></div></div><div class="public anchor" id="var-detach"><h3>detach</h3><div class="usage"><code>(detach component k)</code></div><div class="doc"><div class="markdown"><p>Detach the given component key from this component.</p></div></div><div class="src-link"><a href="https://github.com/xsc/peripheral/blob/master/src/peripheral/component/attach.clj#L59">view source</a></div></div><div class="public anchor" id="var-reify-component"><h3>reify-component</h3><h4 class="type">macro</h4><div class="usage"><code>(reify-component dependencies &amp; component-logic)</code><code>(reify-component &amp; component-logic)</code></div><div class="doc"><div class="markdown"><p>Create a one-off component (i.e. without creating an explicit component record). The syntax is identical to <a href="peripheral.core.html#var-defcomponent">defcomponent</a> without the class name.</p>
<pre><code>(let [db-config {...}]
  (reify-component
    :db (connect! db-config) disconnect!
    ...))
</code></pre>
<p>The resulting value will implement all map interfaces, as well as the <code>com.stuartsierra.component/Lifecycle</code> protocol.</p></div></div><div class="src-link"><a href="https://github.com/xsc/peripheral/blob/master/src/peripheral/component.clj#L167">view source</a></div></div><div class="public anchor" id="var-restart"><h3>restart</h3><div class="usage"><code>(restart component)</code></div><div class="doc"><div class="markdown"><p>Restart the given component by calling <code>stop</code> and <code>start</code>.</p></div></div><div class="src-link"><a href="https://github.com/xsc/peripheral/blob/master/src/peripheral/component.clj#L200">view source</a></div></div><div class="public anchor" id="var-running.3F"><h3>running?</h3><div class="usage"><code>(running? component)</code></div><div class="doc"><div class="markdown"><p>Check whether the component is running (per its metadata).</p></div></div><div class="src-link"><a href="https://github.com/xsc/peripheral/blob/master/src/peripheral/component/state.clj#L15">view source</a></div></div><div class="public anchor" id="var-start"><h3>start</h3><div class="usage"><code>(start component)</code></div><div class="doc"><div class="markdown"><p>Begins operation of this component. Synchronous, does not return until the component is started. Returns an updated version of this component.</p></div></div><div class="src-link"><a href="https://github.com/xsc/peripheral/blob/master/src/peripheral/core.clj#L10">view source</a></div></div><div class="public anchor" id="var-stop"><h3>stop</h3><div class="usage"><code>(stop component)</code></div><div class="doc"><div class="markdown"><p>Ceases operation of this component. Synchronous, does not return until the component is stopped. Returns an updated version of this component.</p></div></div><div class="src-link"><a href="https://github.com/xsc/peripheral/blob/master/src/peripheral/core.clj#L10">view source</a></div></div><div class="public anchor" id="var-subsystem"><h3>subsystem</h3><div class="usage"><code>(subsystem system components)</code></div><div class="doc"><div class="markdown"><p>Create subsystem. The resulting system will only start the given components and their dependencies.</p></div></div><div class="src-link"><a href="https://github.com/xsc/peripheral/blob/master/src/peripheral/system/subsystem.clj#L24">view source</a></div></div><div class="public anchor" id="var-with-start"><h3>with-start</h3><h4 class="type">macro</h4><div class="usage"><code>(with-start [form component &amp; more] &amp; body)</code></div><div class="doc"><div class="markdown"><p>Start the given component, binding the started component to the given form, ensuring the shutdown of the component after the body has been executed.</p></div></div><div class="src-link"><a href="https://github.com/xsc/peripheral/blob/master/src/peripheral/core.clj#L42">view source</a></div></div><div class="public anchor" id="var-with-start*"><h3>with-start*</h3><div class="usage"><code>(with-start* component f)</code></div><div class="doc"><div class="markdown"><p>Start the given component, call the given function with the started component as only parameter, then stop the component.</p></div></div><div class="src-link"><a href="https://github.com/xsc/peripheral/blob/master/src/peripheral/core.clj#L32">view source</a></div></div></div></body></html>